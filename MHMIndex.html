<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Health Tracker — Data Entry</title>
  <style>
    :root { color-scheme: dark; }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0f14; color:#e6edf3; }
    header{ padding:20px; border-bottom:1px solid #1f2a34; display:flex; align-items:center; justify-content:space-between;}
    a{ color:#7cc7ff; text-decoration:none; }
    .container{ max-width:880px; margin:32px auto; padding:0 16px; }
    .card{ background:#0f141b; border:1px solid #1f2a34; border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.25);}
    h1{ margin:0 0 8px; font-size:24px;}
    p.muted{ color:#9fb3c8; margin-top:0 }
    form{ display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:16px; margin-top:8px;}
    label{ font-size:14px; color:#c8d4e0 }
    input{ margin-top:6px; width:100%; padding:12px; border-radius:10px; border:1px solid #243342; background:#0b1117; color:#e6edf3; }
    .actions{ grid-column:1/-1; display:flex; gap:12px; align-items:center; }
    button{ padding:12px 18px; border-radius:10px; border:1px solid #2b3b4c; background:#1a2533; color:#e6edf3; cursor:pointer; }
    button:hover{ filter:brightness(1.1);}
    .tip{ color:#8aa6bf; font-size:12px;}

    /* Calendar */
    .calendar{ margin-top:30px; }
    table{ width:100%; border-collapse:collapse; }
    th, td{ text-align:center; padding:10px; }
    th{ color:#9fb3c8; }
    td{ border:1px solid #1f2a34; border-radius:6px; cursor:pointer; user-select:none; }
    .done{ background:#1e4028; color:#9ff2b0; }
    .missed{ background:#402020; color:#ffb0b0; }
    td:empty{ cursor:default; background:transparent; border:none; }
  </style>
</head>
<body>
  <header>
    <div><strong>Health Tracker</strong> — Daily FBS & BP</div>
    <nav><a href="dashboard.html">Go to Dashboard →</a></nav>
  </header>

  <main class="container">
    <div class="card">
      <h1>Enter Today’s Readings</h1>
      <p class="muted">Minimal dark interface. Data stays in this browser (localStorage).</p>

      <form id="entry-form">
        <div>
          <label>Date
            <input type="date" id="date" required />
          </label>
        </div>
        <div>
          <label>Fasting Blood Sugar (mg/dL)
            <input type="number" id="fbs" inputmode="decimal" min="40" max="400" step="1" required />
          </label>
        </div>
        <div>
          <label>Systolic BP (mmHg)
            <input type="number" id="sbp" min="60" max="250" step="1" required />
          </label>
        </div>
        <div>
          <label>Diastolic BP (mmHg)
            <input type="number" id="dbp" min="40" max="150" step="1" required />
          </label>
        </div>

        <div class="actions">
          <button type="submit">Save entry</button>
          <span class="tip" id="status"></span>
        </div>
      </form>

      <!-- Calendar -->
      <div class="calendar">
        <h2>Submission Calendar — <span id="monthName"></span></h2>
        <table id="calendarTable"></table>
      </div>
    </div>
  </main>

  <script>
    // Pre-fill today
    document.getElementById('date').valueAsDate = new Date();

    function readData(){
      try { return JSON.parse(localStorage.getItem('healthEntries')||'[]'); }
      catch { return []; }
    }
    function writeData(arr){
      localStorage.setItem('healthEntries', JSON.stringify(arr));
    }

    document.getElementById('entry-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const date = document.getElementById('date').value;
      const fbs  = Number(document.getElementById('fbs').value);
      const sbp  = Number(document.getElementById('sbp').value);
      const dbp  = Number(document.getElementById('dbp').value);

      if(!date || isNaN(fbs) || isNaN(sbp) || isNaN(dbp)){
        document.getElementById('status').textContent = 'Please fill all fields correctly.';
        return;
      }
      const entries = readData();
      const i = entries.findIndex(x=>x.date===date);
      const record = { date, fbs, sbp, dbp };
      if(i>=0) entries[i]=record; else entries.push(record);

      entries.sort((a,b)=> a.date.localeCompare(b.date));
      writeData(entries);

      document.getElementById('status').textContent = 'Saved ✔ — Calendar updated.';
      setTimeout(()=>document.getElementById('status').textContent='', 2000);
      e.target.reset();
      document.getElementById('date').value = date;
      buildCalendar(); // refresh calendar colors
    });

    function buildCalendar(){
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth(); // 0-based
      const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      document.getElementById('monthName').textContent = `${monthNames[month]} ${year}`;

      const firstDay = new Date(year, month, 1).getDay(); // 0=Sun
      const daysInMonth = new Date(year, month+1, 0).getDate();
      const entryDates = new Set(readData().map(e=>e.date));

      let html = "<tr>";
      ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=> html += `<th>${d}</th>`);
      html += "</tr><tr>";

      for(let i=0; i<firstDay; i++) html += "<td></td>";

      for(let day=1; day<=daysInMonth; day++){
        const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        const has = entryDates.has(dateStr);
        const cls = has ? "done" : "missed";
        const title = has ? "Entry saved — open dashboard" : "No entry yet — open dashboard";
        html += `<td class="${cls}" data-date="${dateStr}" title="${title}">${day}</td>`;
        if((firstDay + day) % 7 === 0) html += "</tr><tr>";
      }
      html += "</tr>";
      const table = document.getElementById('calendarTable');
      table.innerHTML = html;

      // Make cells clickable → go to dashboard highlighting that date
      table.querySelectorAll('td[data-date]').forEach(td=>{
        td.addEventListener('click', ()=>{
          const d = td.getAttribute('data-date');
          location.href = `dashboard.html?date=${d}`;
        });
      });
    }

    buildCalendar();
  </script>
</body>
</html>
